<?xml version="1.0" encoding="UTF-8"?>
<launch>
  <!-- Args to start different capabilities -->
  <arg name="perception" default="true" />

  <!-- Perception configuration args -->
  <!-- camera topics -->
  <arg name="cloud_topic" value="/head_camera/depth_registered/points" />
  <arg name="camera_color_topic" default="/head_camera/rgb/image_rect_color" />
  <arg name="camera_depth_topic" default="/head_camera/depth/image_rect" />

  <!-- rail_segmentation args -->
  <arg name="segmentation_config" default="$(find rail_semantic_grasping)/config/zones.yaml" />
  <arg name="segmentation_cluster_tolerance" default="0.2" />
  <arg name="segmentation_max_cluster_size" default="30000" />

  <!-- rail_part_affordance_detection args -->
  <arg name="affordance_confidence_threshold" default="0.9" />
  <arg name="affordance_good_range" default="0.005" />
  <arg name="affordance_visualize" default="true" />

  <arg name="grasp_cluster_size" default="3" />
  <arg name="grasp_num_samples" default="4000" />


  <!-- Perception -->
  <group if="$(arg perception)">
    <!-- RAIL Segmentation -->
    <node name="rail_segmentation" pkg="rail_segmentation" type="rail_segmentation" output="screen">
      <param name="zones_config" value="$(arg segmentation_config)" />
      <param name="point_cloud_topic" value="$(arg cloud_topic)" />
      <param name="cluster_tolerance" value="$(arg segmentation_cluster_tolerance)" />
      <param name="label_markers" value="true" />
      <param name="max_cluster_size" value="$(arg segmentation_max_cluster_size)" />
<!--      <param name="min_cluster_size" value="75" />-->
<!--      <param name="crop_first" value="true" />-->
<!--      <param name="label_markers" value="true" />-->
    </node>

    <!-- RAIL part affordance detection -->
    <include file="$(find rail_part_affordance_detection)/launch/recognition.launch">
      <arg name="camera_color_topic" value="$(arg camera_color_topic)" />
      <arg name="camera_depth_topic" value="$(arg camera_depth_topic)" />
      <arg name="confidence_threshold" default="$(arg affordance_confidence_threshold)" />
      <arg name="good_range" default="$(arg affordance_good_range)" />
      <arg name="visualize" default="$(arg affordance_visualize)" />
    </include>

    <!-- RAIL semantic grasping -->
    <node name="rail_semantic_grasping" pkg="rail_semantic_grasping" type="rail_semantic_grasping" output="screen">
      <param name="label_markers" value="true" />
      <param name="min_affordance_pixels" value="100" />
    </node>

    <!-- RAIL Segmentation post processing -->
<!--    <node pkg="rail_segmentation_tools" type="merger" name="merger" />-->

    <!-- Grasp Suggestion -->
<!--    <include file="$(find fetch_grasp_suggestion)/launch/grasp_suggestion.launch">-->
<!--      <arg name="cloud_topic" value="$(arg cloud_topic)" />-->
<!--      <arg name="classifier_file" value="$(arg grasp_classifier_file)" />-->
<!--      <arg name="cluster_size" value="$(arg grasp_cluster_size)" />-->
<!--      <arg name="num_samples" value="$(arg grasp_num_samples)" />-->
<!--    </include>-->
  </group>

</launch>
